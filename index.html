<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Package Pickup Form</title>
  <link rel="stylesheet" href="style.css">
  <meta name="color-scheme" content="light dark">
  <style>
    /* Modal styles */
    .modal { position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:1000; }
    .modal.is-hidden { display:none; }
    .modal-content { background:#fff; padding:2rem; border-radius:8px; box-shadow:0 2px 16px rgba(0,0,0,0.2); text-align:center; color:#0f172a; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true"></div>
        <span class="brand-name">DB Doorstep Courier Services</span>
      </div>
      <nav class="top-nav" aria-label="Main">
        <a href="#" class="nav-link is-active">Form</a>
        <a href="help.html" class="nav-link">Help</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-inner">
      <div class="hero-copy">
        <h1 class="h1">Package Pickup</h1>
        <p class="muted">Enter your details so we can send our agent to pick up your package at your home and on time.</p>
      </div>
    </div>
  </section>

  <!-- Status banners -->
  <div class="container">
    <div id="alertSuccess" class="alert alert-success is-hidden">
      <strong>Success:</strong> Your pickup information was submitted.
    </div>
    <div id="alertError" class="alert alert-error is-hidden">
      <strong>Error:</strong> Something went wrong. Please try again.
    </div>
  </div>

  <!-- Form + Aside -->
  <main class="container grid">
    <!-- Card: Form -->
    <section class="card">
      <h2 class="h2">Pickup Details</h2>
      <form id="pickupForm" class="form" novalidate>
        <!-- Name -->
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input id="fullName" name="fullName" type="text" placeholder="First Last" required autocomplete="name" class="input">
          <small class="help">As it appears on your ID.</small>
        </div>

        <!-- Address -->
        <div class="grid grid-2">
          <div class="form-group grid-span-2">
            <label for="street">Street Address</label>
            <input id="street" name="street" type="text" placeholder="APT, HOUSE NUMBER, STREET NAME" required autocomplete="address-line1" class="input">
          </div>
          <div class="form-group">
            <label for="city">City</label>
            <input id="city" name="city" type="text" placeholder="City" required autocomplete="address-level2" class="input">
          </div>
          <div class="form-group">
            <label for="state">State/Province</label>
            <input id="state" name="state" type="text" placeholder="State" required autocomplete="address-level1" class="input">
          </div>
          <div class="form-group">
            <label for="postal">Postal Code</label>
            <input id="postal" name="postal" type="text" placeholder="ZIP / Postal" required autocomplete="postal-code" class="input">
          </div>
          <div class="form-group">
            <label for="country">Country</label>
            <input id="country" name="country" type="text" placeholder="Country" required autocomplete="country-name" class="input">
          </div>
          <div class="form-group">
            <label for="phone">Phone</label>
            <input id="phone" name="phone" type="tel" placeholder="+44 5555 555555" required autocomplete="tel" class="input">
          </div>
        </div>

        <!-- Notes -->
        <div class="form-group">
          <label for="notes">Pickup Notes (optional)</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Gate code, preferred time, etc." class="input"></textarea>
        </div>

        <!-- Honeypot (spam protection) -->
        <input type="text" name="_gotcha" class="honeypot" tabindex="-1" autocomplete="off" aria-hidden="true">

        <!-- Consent -->
        <label class="checkbox">
          <input type="checkbox" id="consent" name="consent" required>
          <span>I confirm these details are correct.</span>
        </label>

        <!-- Actions -->
        <div class="actions">
          <button id="submitBtn" type="submit" class="btn btn-primary">Submit</button>
          <span id="formStatus" class="status" aria-live="polite"></span>
        </div>
      </form>
    </section>

    <!-- Card: Reassurance -->
    <aside class="card">
      <h3 class="h3">What happens next?</h3>
      <p class="muted">After submission, our team verifies your address and schedules pickup. You’ll receive a confirmation email with your pickup details.</p>
      <div class="divider"></div>
      <h3 class="h3">Privacy</h3>
      <p class="muted">We only use your details for pickup. No spam, ever.</p>
    </aside>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>© 2025 DB Doorstep Courier Services. All rights reserved.</small>
    </div>
  </footer>

  <!-- Thank You Modal -->
  <div id="thankYouModal" class="modal is-hidden" role="dialog" aria-modal="true" aria-labelledby="thankYouTitle">
    <div class="modal-content">
      <h2 id="thankYouTitle">Thank You!</h2>
      <p>Your form has been submitted successfully. We appreciate your request.</p>
      <button id="closeModalBtn" class="btn">Close</button>
    </div>
  </div>
<!-- Minimal HTML targets (examples) -->
<form id="pickup-form" novalidate>
  <!-- ...your inputs with name="fullName" etc... -->
  <input type="checkbox" required id="confirm">
  <button id="submit-btn" type="submit">Submit</button>
</form>

<div id="alert-success" class="is-hidden" role="alert"></div>
<div id="alert-error" class="is-hidden" role="alert"></div>
<div id="status" aria-live="polite"></div>

<!-- Optional thank-you modal -->
<div id="thank-you" class="is-hidden" role="dialog" aria-modal="true">
  <p>Thanks! We received your request.</p>
  <button id="close-modal">Close</button>
</div>

<script type="module">
const FORMSPREE_ENDPOINT = "https://formspree.io/f/movlblkl"; // <- replace with YOUR endpoint

// Safe DOM helpers
const $ = (sel) => document.querySelector(sel);
const form = $("#pickup-form");
const btn = $("#submit-btn");
const alertSuccess = $("#alert-success");
const alertError = $("#alert-error");
const statusEl = $("#status");
const thankYouModal = $("#thank-you");
const closeModalBtn = $("#close-modal");

function setStatus(msg, isError = false) {
  if (!statusEl) return;
  statusEl.textContent = msg || "";
  statusEl.classList.toggle("is-error", !!isError);
}

// Guard: bail if form not found
if (!form) {
  console.error("Form not found: #pickup-form");
} else {
  form.addEventListener("submit", onSubmit);
}

async function onSubmit(e) {
  e.preventDefault();

  // Reset UI
  alertSuccess?.classList.add("is-hidden");
  alertError?.classList.add("is-hidden");
  setStatus("");
  if (btn) {
    btn.disabled = true;
    btn.classList.add("is-loading");
  }

  // Validate required fields
  const required = ["fullName","street","city","state","postal","country","email","phone"];
  for (const name of required) {
    const el = form.elements[name];
    if (!el || !el.value.trim()) {
      setStatus("Please complete all required fields.", true);
      el?.focus?.();
      if (btn) {
        btn.disabled = false;
        btn.classList.remove("is-loading");
      }
      return;
    }
  }

  // Simple email sanity check (optional)
  const email = form.elements["email"]?.value?.trim();
  if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    setStatus("Please enter a valid email address.", true);
    form.elements["email"]?.focus?.();
    if (btn) {
      btn.disabled = false;
      btn.classList.remove("is-loading");
    }
    return;
  }

  // Checkbox consent
  const consentCheckbox = form.querySelector('input[type="checkbox"][required]');
  if (consentCheckbox && !consentCheckbox.checked) {
    setStatus("Please confirm your details are correct.", true);
    consentCheckbox.focus();
    if (btn) {
      btn.disabled = false;
      btn.classList.remove("is-loading");
    }
    return;
  }

  // Build FormData for Formspree
  const fd = new FormData(form);
  fd.append("_subject", "New Pickup Request");
  // Optional: fd.append("_replyto", email || "");

  setStatus("Submitting…");

  try {
    const resp = await fetch(FORMSPREE_ENDPOINT, {
      method: "POST",
      headers: { "Accept": "application/json" }, // don't set Content-Type for FormData
      body: fd
    });

    // Handle 200/OK and 302/redirect patterns
    const contentType = resp.headers.get("content-type") || "";
    const data = contentType.includes("application/json")
      ? await resp.json().catch(() => ({}))
      : {};

    if (resp.ok) {
      form.reset();
      setStatus("");
      if (alertSuccess) {
        alertSuccess.innerHTML = "<strong>Thank you:</strong> your pickup information was submitted.";
        alertSuccess.classList.remove("is-hidden");
      }
      const original = btn?.textContent;
      if (btn) {
        btn.textContent = "Thank you";
        setTimeout(() => (btn.textContent = original), 2000);
      }
      thankYouModal?.classList.remove("is-hidden");
      closeModalBtn?.focus?.();
    } else {
      // Formspree returns helpful messages on 4xx
      let msg = "Submission failed. Please try again.";
      if (data?.errors?.length) msg = data.errors.map(e => e.message).join(" ");
      if (data?.error) msg = data.error;
      if (alertError) {
        alertError.textContent = msg;
        alertError.classList.remove("is-hidden");
      }
      setStatus("", true);
    }
  } catch (err) {
    console.error(err);
    if (alertError) {
      alertError.textContent = "Network error. Please try again.";
      alertError.classList.remove("is-hidden");
    }
    setStatus("", true);
  } finally {
    if (btn) {
      btn.disabled = false;
      btn.classList.remove("is-loading");
    }
  }
}

// Optional: close modal
closeModalBtn?.addEventListener("click", () => {
  thankYouModal?.classList.add("is-hidden");
  btn?.focus?.();
});
</script>
  <script src="form.js" defer></script>
</body>
</html>
